/*
********************************************************************************************
*
*        Copyright (c): 2016 - 2016 + 5, Fuzhou Rockchip Electronics Co., Ltd
*                             All rights reserved.
*
* FileName: Cpu\NanoD\lib\wdt.c
* Owner: aaron.sun
* Date: 2016.9.28
* Time: 10:23:34
* Version: 1.0
* Desc: wdt bsp c file
* History:
*    <author>    <date>       <time>     <version>     <Desc>
*    aaron.sun     2016.9.28     10:23:34   1.0
********************************************************************************************
*/

#define __CPU_NANOD_LIB_WDT_C__
#include "BspConfig.h"
#ifdef __CPU_NANOD_LIB_WDT_C__

/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   #include define
*
*---------------------------------------------------------------------------------------------------------------------
*/
#include "typedef.h"
#include "wdt.h"
#include "Hw_memap.h"
#include "Hw_wdt.h"


/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   #define / #typedef define
*
*---------------------------------------------------------------------------------------------------------------------
*/

#define WDT_RST_PLUSE_LENGT_OFFSET   2
#define WDT_RESP_MODE_OFFSET         1


/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   local variable define
*
*---------------------------------------------------------------------------------------------------------------------
*/



/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   global variable define
*
*---------------------------------------------------------------------------------------------------------------------
*/



/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   local function declare
*
*---------------------------------------------------------------------------------------------------------------------
*/



/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   API(common) define
*
*---------------------------------------------------------------------------------------------------------------------
*/
/*******************************************************************************
** Name: WatchDogStart
** Input:void
** Return: void
** Owner:wrm
** Date: 2015.5.19
** Time: 10:50:13
*******************************************************************************/
_CPU_NANOD_LIB_WDT_COMMON_
COMMON API rk_err_t WatchDogStart(void)
{
    int backup = Wdt->WDT_CR;
    Wdt->WDT_CR = 1 |backup;
    return RK_SUCCESS;
}

/*******************************************************************************
** Name: WatchDogClearIntFlag
** Input:void
** Return: void
** Owner:wrm
** Date: 2015.5.19
** Time: 10:50:13
*******************************************************************************/
_CPU_NANOD_LIB_WDT_COMMON_
COMMON API rk_err_t WatchDogClearIntFlag(void)
{
    uint32 eoi;
    eoi = Wdt->WDT_EOI;
    return eoi;
}
/*******************************************************************************
** Name: WatchDogGetCurrentValue
** Input:void
** Return: void
** Owner:wrm
** Date: 2015.5.19
** Time: 10:50:13
*******************************************************************************/
_CPU_NANOD_LIB_WDT_COMMON_
COMMON API rk_size_t WatchDogGetCurrentValue(void)
{
    return Wdt->WDT_CCVR;
}
/*******************************************************************************
** Name: WatchDogSetPeriod
** Input:WdtTimeoutPeriod_t
** Return: OK
** Owner:wrm
** Date: 2015.5.19
** Time: 10:50:13
*******************************************************************************/
_CPU_NANOD_LIB_WDT_COMMON_
COMMON API rk_err_t WatchDogSetPeriod(WdtTimeoutPeriod_t period)
{
    Wdt->WDT_TORR = period;
    return RK_SUCCESS;
}
/*******************************************************************************
** Name: WatchDogReload
** Input:void
** Return: void
** Owner:wrm
** Date: 2015.5.19
** Time: 10:50:13
*******************************************************************************/
_CPU_NANOD_LIB_WDT_COMMON_
COMMON API rk_err_t WatchDogReload(void)
{
    Wdt->WDT_CRR = 0x76;
    return RK_SUCCESS;
}
/*******************************************************************************
** Name: WatchDogGetStat
** Input:void
** Return: void
** Owner:wrm
** Date: 2015.5.19
** Time: 10:50:13
*******************************************************************************/
_CPU_NANOD_LIB_WDT_COMMON_
COMMON API rk_size_t WatchDogGetStat(void)
{
    return Wdt->WDT_STAT;
}


/*******************************************************************************
** Name: WatchDogInit
** Input:WdtRespMode_t,WdtRstPluseLenth_t,WdtTimeoutPeriod_t
** Return: OK
** Owner:wrm
** Date: 2015.5.19
** Time: 10:50:13
*******************************************************************************/
COMMON API rk_err_t WatchDogInit(WdtRespMode_t mode , WdtRstPluseLenth_t RstPluse, WdtTimeoutPeriod_t period)
{
    Wdt->WDT_CR = (mode << WDT_RESP_MODE_OFFSET) | (RstPluse << WDT_RST_PLUSE_LENGT_OFFSET);

    WatchDogSetPeriod(period);
    WatchDogReload();

    return RK_SUCCESS;
}



/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   local function(common) define
*
*---------------------------------------------------------------------------------------------------------------------
*/



/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   API(init) define
*
*---------------------------------------------------------------------------------------------------------------------
*/



/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   local function(init) define
*
*---------------------------------------------------------------------------------------------------------------------
*/



/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   API(shell) define
*
*---------------------------------------------------------------------------------------------------------------------
*/



/*
*---------------------------------------------------------------------------------------------------------------------
*
*                                                   local function(shell) define
*
*---------------------------------------------------------------------------------------------------------------------
*/



#endif
